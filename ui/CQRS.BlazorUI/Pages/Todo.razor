@page "/todo"
@using CQRS.BlazorUI.Components.Todo
@using CQRS.BlazorUI.Models

<PageTitle>Todo</PageTitle>

<h1>To-Dos</h1>
<TodoForm 
    OnAdd="AddTodo">
</TodoForm>

<TodoTable 
    todoCount="@todoCount" 
    todoItems="@todoItems" 
    OnDone="DoneTodo" 
    OnRemove="RemoveTodo">
</TodoTable>

@code {
    private List<TodoItem> todoItems = new();
    private int nextId = 1;
    private int todoCount = 0;

    private void AddTodo(TodoItem todoItem)
    {
        todoItem.Id = nextId++;     // ASSIGN the id and then increment
        todoItems.Add(todoItem);    // ADD to the collection (List)
        CountTheTodo();             // RESET the count
    }

    private void RemoveTodo(int id)
    {
        var item = todoItems.FirstOrDefault(f => f.Id == id);

        if (item != null)
        {
            todoItems.Remove(item);
            CountTheTodo();
        }
    }

    private void DoneTodo(int id)
    {
        var item = todoItems.FirstOrDefault(f => f.Id == id);

        if (item != null)
        {
            item.IsDone = true;
            CountTheTodo();
        }
    }

    private void CountTheTodo()
    {
        todoCount = todoItems.Count(toto => !toto.IsDone);
    }
}